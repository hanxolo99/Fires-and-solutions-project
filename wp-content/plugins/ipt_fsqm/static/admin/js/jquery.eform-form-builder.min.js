/*!
* eForm - WordPress Form Builder
*
* Autogenerated by Grunt on: 2019-01-08
* @version 3.8.0
* @author Swashata Ghosh (WPQuark)
* @license GPL-3.0
*/
!function(e){"use strict";var t=function(e){return e.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},i=function(t){var i,a=e("<div />");return a.html(t),i=a.text(),a.remove(),i},a=function(e,t){var i=t.length,a=e.length;if(a>i)return!1;if(a===i)return e===t;e:for(var n=0,r=0;n<a;n++){for(var o=e.charCodeAt(n);r<i;)if(t.charCodeAt(r++)===o)continue e;return!1}return!0},n=function(e){this.jElement=e,this.init()};n.prototype={init:function(){this.keys=e.extend(!0,{},JSON.parse(this.jElement.find("input.ipt_uif_builder_default_keys").val()),JSON.parse(this.jElement.find("input.ipt_uif_builder_keys").val())),this.replaces=JSON.parse(this.jElement.find("input.ipt_uif_builder_replace_string").val()),this.mainForm=e(".ipt_uif > form"),this.settingsBox=this.jElement.find(".ipt_uif_builder_settings_box"),this.settingsWrap=e("#ipt-eform-builder-settings-wrap"),this.settingsTab=e("#ipt-eform-settings-tab-wrapper"),this.settingsNavNext=e(".builder_settings_next"),this.settingsNavPrev=e(".builder_settings_prev"),this.settingsEditorLi=e("#ipt-eform-settings-editor-li"),this.tabs=this.jElement.find("#ipt_fsqm_form_builder_layout"),this.adds=this.jElement.find("#ipt-eform-builder-toolbar-addcontainer"),this.elementAdders=this.jElement.find("#ipt_fsqm_builder_droppable"),this.iframeRefreshButton=e("#ipt-eform-builder-toolbar-actions .refresher"),this.iframeContainer=e(".eform-builder-form-iframe"),this.iframeElm=e("#eform-builder-liveview-iframe"),this.iframeSize=e("#ipt-eform-builder-toolbar-iframe-size"),this.iframeOverlayIndicator=e("#eform-builder-live-iframe-loading"),this.builderApp=e("#ipt-eform-builder-app"),this.paneSelector=e("#ipt-eform-builder-toolbar-split-pane-mode"),this.pane=e("#ipt-eform-builder-split-window"),this.paneLeft=e("#eform-split-view-left"),this.paneRight=e("#eform-split-view-right"),this.paneResize=e("#eform-split-view-resize"),this.saveButton=e("#ipt-eform-builder-toolbar-save"),this.toolbarWorkingIndicator=e("#ipt-eform-builder-toolbar .loader-viewer"),this.collapseButton=e("#ipt-eform-builder-sidebar-collapse"),this.tabPanelContent=this.jElement.find(".ipt_uif_builder_tab_content").text(),this.tabLiContent=this.jElement.find(".ipt_uif_builder_tab_li").text(),this.deleteMsgTitle=this.tabs.data("deldropper-title"),this.deleteMsgContent=this.tabs.data("deldropper-msg"),this.deleteDialogueContent=e("<div><p>"+this.deleteMsgContent+"</p></div>"),this.hasContentChanged=!1,this.currentSettingsOrigin=null,this.currentSettingsParent=null,this.isFormSaving=!1,this.formSaveLastXHR=null,this.applySettingsBoxEvents(),this.applyMainTabLayout(),this.applyMainTabDropZone(),this.applyAddLayout(),this.applyElementActions(),this.applyCustomizer(),this.applyLivePreview(),this.applySplitPane(),this.applySaveAndSync(),this.applyLayoutActions(),this.applyElementAdder(),this.applyContextHelp(),this.applyCollapserEvent(),this.finalizeFormBuilderUI(),this.applyOnboarding()},applyCollapserEvent:function(){var e=this;this.collapseButton.on("click",function(t){t.preventDefault(),e.builderApp.toggleClass("eform-app-collapsed"),e._resetPaneSize()})},_updateDuplicatedDOMElementKeys:function(t){var i=t.find("> input.ipt_uif_builder_helper.element_m_type").val(),a=(t.find("> input.ipt_uif_builder_helper.element_type").val(),parseInt(t.find("> input.ipt_uif_builder_helper.element_key").val(),10)),n=i+"\\["+a+"\\]",r=i+"_"+a+"_",o=this.keys,s=0;void 0!==o[i]?s=o[i]++:o[i]=s,t.find(">.ipt_uif_builder_settings").find("input, textarea, select, button, datalist, keygen, output, label").each(function(){var t=e(this),a=t.attr("name"),o=t.attr("id"),l=t.attr("for");a&&t.attr("name",a.replace(new RegExp(n,"g"),i+"["+s+"]")),o&&t.attr("id",o.replace(new RegExp(r,"g"),i+"_"+s+"_")),l&&t.attr("for",l.replace(new RegExp(r,"g"),i+"_"+s+"_"))}),t.find("script.ipt_uif_sda_data").each(function(){var t=e(this).html().replace(new RegExp(n,"g"),i+"["+s+"]").replace(new RegExp(r,"g"),i+"_"+s+"_");e(this).html(t)}),t.find(".icons-selector").remove(),t.find(">input.ipt_uif_builder_helper.element_key").val(s),t.find("input.ipt_uif_builder_helper.element_identifier").attr("id","eform-form-element-settings-"+i+"-"+s);var l=t.find("> .ipt_uif_droppable_element_wrap > .ipt_uif_droppable_element_head > h3 > .element_info");return l.text(l.text().replace(a,s)),t.find(".ui-tabs-active").removeClass("ui-tabs-active"),s},_updateDuplicatedDOMInnerKeys:function(t,i){var a=this;t.data("containerKey",i);var n=i,r=t.data("replaceby")+"["+n+"][elements]";t.find(">.ipt_uif_droppable_element").each(function(){var t=e(this),i=a._updateDuplicatedDOMElementKeys(t);t.find("> input.ipt_uif_builder_helper.element_m_type").attr("name",r+"[m_type][]"),t.find("> input.ipt_uif_builder_helper.element_type").attr("name",r+"[type][]"),t.find("> input.ipt_uif_builder_helper.element_key").attr("name",r+"[key][]");var n=t.find("> .ipt_uif_droppable_element_wrap > .ipt_uif_builder_drop_here");n.length&&n.each(function(){a._updateDuplicatedDOMInnerKeys(e(this),i)})})},_duplicateElement:function(t){if(!t.data("dbmap")){var i,a=this,n=t.clone(),r=null,o=t.find("textarea"),s=n.find("textarea");if(o.length)for(var l=0;l<o.length;l++)e(s[l]).val(e(o[l]).val());n.find('[data-dbmap="1"]').remove(),i=this._updateDuplicatedDOMElementKeys(n),n.hide(),t.after(n),(r=n.find("> .ipt_uif_droppable_element_wrap > .ipt_uif_builder_drop_here")).length&&(r.each(function(){a._updateDuplicatedDOMInnerKeys(e(this),i)}),this._makePanelDropNSortable(n)),n.slideDown("fast"),this.jElement.trigger("elementCopied.eform")}},_deleteElement:function(e){var t=this,i=e.closest(".ipt_uif_builder_drop_here");1===e.data("dbmap")&&e.data("ipt_uif_builder_dbmap_original").removeClass("ipt_uif_droppable_element_disabled");t._closeSettingsBox(),e.find(".ipt_uif_droppable_element_wrap").addClass("red"),e.animate({height:0,opacity:0},"normal",function(){e.remove(),i.find(".ipt_uif_droppable_element:not(.ui-sortable-placeholder):not(.ui-sortable-helper)").length<1&&i.addClass("ipt_uif_builder_drop_here_empty"),t.jElement.trigger("elementDeleted.eform")})},_setMainTabCount:function(){this.tabCounter=this.tabs.find("> .ui-tabs-nav > li").length},_addEmptyClassToMainTab:function(){0===this.tabCounter&&this.tabs.addClass("ipt_uif_builder_empty")},_revealUI:function(){var t=e("#ipt_fsqm_fb_p_al");t.length&&(t.hide(),e(".ipt_fsqm_fb_hidden_init").removeClass("ipt_fsqm_fb_hidden_init"))},_handleEdgeCaseTimer:function(){var t=function(){"page_specific"==e("#settings_timer_time_limit_type").val()?e("#ipt_fsqm_form").addClass("ipt-fsqm-ps-timer"):e("#ipt_fsqm_form").removeClass("ipt-fsqm-ps-timer")};t(),e("#settings_timer_time_limit_type").on("change",t)},_setConfirmExit:function(){var t=this;e(window).on("beforeunload",function(){return t.hasContentChanged?"You have unsaved changes. Leaving this page will discard the changes":void 0}),e(document).on("click","#ipt_fsqm_settings_save, #ipt_fsqm_add_layout, .ipt_uif_builder_layout_settings, .ipt_uif_builder_layout_del",function(){t.hasContentChanged=!0}),e(document).on("dragstop",".ipt_uif_droppable_element, .ipt_uif_builder_layout_tabs",function(){t.hasContentChanged=!0}),e(document).on("sortstop",".ipt_uif_builder_drop_here, .ipt_uif_builder_layout_tab",function(){t.hasContentChanged=!0}),e(document).on("change","input, select, textarea",function(){t.hasContentChanged=!0}),e(document).on("slidestop",function(){t.hasContentChanged=!0}),e(document).on("formSaved.eform",function(){t.hasContentChanged=!1})},_setShortcutKeys:function(){var t=this;e(document).on("keydown",function(e){if((e.ctrlKey||e.metaKey)&&83===e.keyCode&&(e.preventDefault(),t._saveAndSyncIframe("formSaved")),e.altKey)switch(e.keyCode){case 80:e.preventDefault(),t._addNewPageToLayout();break;case 67:e.preventDefault(),t._addShortcutElementToActiveTabPanel("checkbox");break;case 82:e.preventDefault(),t._addShortcutElementToActiveTabPanel("radio");break;case 68:e.preventDefault(),t._addShortcutElementToActiveTabPanel("select");break;case 84:e.preventDefault(),t._addShortcutElementToActiveTabPanel("feedback_large");break;case 73:e.preventDefault(),t._addShortcutElementToActiveTabPanel("feedback_small");break;case 70:e.preventDefault(),t._addShortcutElementToActiveTabPanel("f_name");break;case 76:e.preventDefault(),t._addShortcutElementToActiveTabPanel("l_name");break;case 69:e.preventDefault(),t._addShortcutElementToActiveTabPanel("email");break;case 71:e.preventDefault(),t._addShortcutElementToActiveTabPanel("grading");break;case 83:e.preventDefault(),t._addShortcutElementToActiveTabPanel("starrating");break;case 79:e.preventDefault(),t._addShortcutElementToActiveTabPanel("sorting");break;case 77:e.preventDefault(),t._addShortcutElementToActiveTabPanel("matrix");break;case 65:e.preventDefault(),t._addShortcutElementToActiveTabPanel("repeatable")}})},_addInitialTabIfNeeded:function(){this.tabs.hasClass("ipt_uif_builder_empty")&&this._addNewPageToLayout()},_applyTippy:function(){setTimeout(function(){var t={target:".eform-builder-tippy",placement:"bottom-end",arrowType:"round",distance:15,size:"regular",maxWidth:"200px",theme:"eform-tippy",performance:!1,arrow:!0,popperOptions:{modifiers:{preventOverflow:{escapeWithReference:!0}}},zIndex:16e4};tippy("#ipt-eform-builder-toolbar",t),tippy("#ipt-eform-builder-contextbar",t),tippy("#ipt-eform-droppables-search",t),tippy("#ipt-eform-builder-settings-wrap",e.extend({},t,{sticky:!0}))},1e3)},finalizeFormBuilderUI:function(){this._addInitialTabIfNeeded(),this._handleEdgeCaseTimer(),this._setConfirmExit(),this._setShortcutKeys(),this._revealUI(),this._applyTippy()},_saveForm:function(t){this.isFormSaving&&this.formSaveLastXHR.abort();var i=this;this.isFormSaving=!0,this.saveButton.addClass("active"),this.toolbarWorkingIndicator.addClass("active");var a={action:this.mainForm.find('[name="action"]').val(),ipt_ps_post:this.mainForm.serialize(),ipt_ps_send_as_str:!0,ipt_ps_look_into:"ipt_ps_post"};this.formSaveLastXHR=e.post(ajaxurl,a).done(function(e){"cheating"===e?alert("Failed nonce verification. Please refresh this page."):(i.jElement.trigger("formSaved.eform"),"function"==typeof t&&t(e))}).fail(function(e,t){"abort"!==t&&iziToast.show({message:eFormBuilderL10n.saveError,theme:"light",color:"red",icon:"ipt-icomoon-error",layout:1,closeOnClick:!0,displayMode:0,position:"center",timeout:3e3,pauseOnHover:!0})}).always(function(){i.isFormSaving=!1,i.saveButton.removeClass("active"),i.toolbarWorkingIndicator.removeClass("active")})},_saveAndSyncIframe:function(e){var t=this;this._startIframeOverlay(),this._saveForm(function(i){t._fireIframeSyncEvents(i);var a=eFormBuilderL10n[e]?eFormBuilderL10n[e]:eFormBuilderL10n.done,n="green",r="ipt-icomoon-done";-1!==e.toLowerCase().indexOf("delete")&&(n="yellow",r="ipt-icomoon-delete"),setTimeout(function(){iziToast.show({message:a,theme:"light",color:n,icon:r,layout:1,closeOnClick:!0,transitionIn:"fadeIn",displayMode:0,position:"topRight",timeout:1500,pauseOnHover:!0})},50)})},_refreshMainTabs:function(){var e=this.tabs;e.tabs("refresh"),e.find("> .ui-tabs-nav").sortable("refresh"),e.find("> .ui-tabs-nav").sortable("refreshPositions"),this._setMainTabCount(),this._addEmptyClassToMainTab()},applyMainTabLayout:function(){var e=this,t=this.tabs;t.tabs(),t.find("> .ui-tabs-nav").sortable({placeholder:"ipt_uif_builder_tabs_sortable_highlight",stop:function(){e._refreshMainTabs(),e.jElement.trigger("pageSorted.eform")},handle:".ipt_uif_builder_tab_sort",tolerance:"pointer",containment:"parent",distance:5,axis:"x"}),this._setMainTabCount(),this._addEmptyClassToMainTab()},_updateElementTitle:function(e){var t=e.find(".element_m_type").val()+"_"+e.find(".element_key").val()+"_title",a=e.find("#"+t).val();(a=i(a))&&"string"==typeof a&&(e.find("> .ipt_uif_droppable_element_wrap > .ipt_uif_droppable_element_head > h3.element_title_h3 > span.element_title").text(" : "+a.trim()),e.find("> .ipt_uif_droppable_element_wrap > .ipt_uif_droppable_element_head > h3.element_title_h3").attr("title",a.trim()))},_cleanUpTabPanelAfterDrop:function(e,t,i){e.removeClass("ipt_uif_builder_drop_here_empty"),this.jElement.trigger("element"+t+".eform"),"function"==typeof i&&i()},_addShortcutElementToActiveTabPanel:function(e){var t=this.elementAdders.find(".ipt-eform-droppable-elm-"+e);t.length&&!t.hasClass("ipt_uif_droppable_element_disabled")&&(this.tabCounter<1&&this._addNewPageToLayout(),this._addElementToTabPanel(t,this._getActiveTabPanelDropZone()))},_addElementToTabPanel:function(i,a,n){var r=i.clone(),o=a.data("containerKey"),s=r.find("> .ipt_uif_builder_settings"),l=e('<div class="ipt_uif_builder_settings"></div>'),d=l.html(s.text()).text();l.html(d),s.remove(),r.find(".ipt_uif_droppable_element_wrap").before(l);var p=i.data("replacethis"),_=a.data("replaceby"),f=0,u=r.find(".element_m_type").val();void 0!==this.keys[u]?f=this.keys[u]++:this.keys[u]=f;var c=new RegExp(t(this.replaces.key),"g"),h=new RegExp(t(this.replaces.l_key),"g"),m=new RegExp(t(p),"g");r.html(function(e,t){var i=t.replace(c,f);return(i=i.replace(m,_)).replace(h,o)}),r.find("> input.element_m_type").attr("disabled",!1),r.find("> input.element_type").attr("disabled",!1),r.find("> input.element_key").attr("disabled",!1),1===r.data("dbmap")&&(i.addClass("ipt_uif_droppable_element_disabled"),r.data("ipt_uif_builder_dbmap_original",i)),r.addClass("ipt_uif_droppable_element_added"),r.hide(),a.append(r),r.find(".ipt_uif_builder_drop_here").length&&this._makePanelDropNSortable(r),this._updateElementTitle(r),r.slideDown("fast"),this._cleanUpTabPanelAfterDrop(a,"Added",n)},_moveElementToTabPanel:function(e,t,i){if(!t.is(e.parent())){var a=t.data("replaceby")+"["+t.data("containerKey")+"][elements]";e.find("> input.element_m_type").attr("name",a+"[m_type][]"),e.find("> input.element_type").attr("name",a+"[type][]"),e.find("> input.element_key").attr("name",a+"[key][]"),e.data("ipt_uif_droppable_move",t),e.addClass("ipt_uif_droppable_element_move")}this._cleanUpTabPanelAfterDrop(t,"Moved",i)},_addOrMoveElementToTabPanel:function(e,t,i){e.hasClass("ipt_uif_droppable_element_added")?this._moveElementToTabPanel(e,t,i):this._addElementToTabPanel(e,t,i)},_makePanelDropNSortable:function(t){var i=this;t.find(".ipt_uif_builder_drop_here").droppable({greedy:!0,accept:".ipt_uif_droppable_element",tolerance:"pointer",activate:function(t,i){e(this).addClass("ipt_uif_highlight")},deactivate:function(t,i){e(this).removeClass("ipt_uif_highlight")},over:function(t,i){e(this).addClass("ipt_uif_droppable_hover"),i.helper.find(".ipt_uif_droppable_element_wrap").addClass("white")},out:function(t,i){e(this).removeClass("ipt_uif_droppable_hover"),i.helper.find(".ipt_uif_droppable_element_wrap").removeClass("white")},drop:function(t,a){var n=e(this);a.helper.find(".ipt_uif_droppable_element_wrap").removeClass("white"),n.removeClass("ipt_uif_highlight"),n.removeClass("ipt_uif_droppable_hover"),i._addOrMoveElementToTabPanel(a.draggable,n)}}).sortable({items:"> .ipt_uif_droppable_element",handle:"> div > .ipt_uif_droppable_element_head > a.ipt_uif_builder_sort_handle",helper:function(t,i){var a=i.attr("class"),n=i.find("> .ipt_uif_droppable_element_wrap"),r=e('<div class="'+a+'"><div class="'+n.attr("class")+'"></div></div>');return r.addClass("ui-sortable-helper"),r.find("> .ipt_uif_droppable_element_wrap").append(n.find("> .ipt_uif_droppable_element_head").clone()),r.appendTo(e(this))},cancel:".ipt_uif_droppable_element_cancel_sort",cursorAt:{left:28,top:25},stop:function(t,i){if(i.item.hasClass("ipt_uif_droppable_element_move")){var a=e(this),n=i.item.data("ipt_uif_droppable_move");i.item.removeClass("ipt_uif_droppable_element_move");var r=i.item.parent();i.item.slideUp("fast",function(){i.item.appendTo(n).slideDown("fast",function(){r.find(".ipt_uif_droppable_element:not(.ui-sortable-placeholder):not(.ui-sortable-helper)").length<1&&r.addClass("ipt_uif_builder_drop_here_empty"),n.sortable("refresh"),a.sortable("refresh")})})}}}),t.find(".ipt_uif_droppable_element").each(function(){var t=e(this);if(1===t.data("dbmap")){var a=t.attr("class"),n=i.jElement.find(".ipt_uif_droppable .ipt_uif_droppable_element").filter('[class="'+a+'"]').addClass("ipt_uif_droppable_element_disabled");t.data("ipt_uif_builder_dbmap_original",n)}t.addClass("ipt_uif_droppable_element_added")})},_makeLiDroppable:function(t){var i=this;t.find(".ipt_uif_builder_tab_droppable").droppable({greedy:!0,accept:".ipt_uif_droppable_element",tolerance:"pointer",activate:function(t,i){e(this).addClass("ipt_uif_builder_tab_droppable_highlight")},deactivate:function(t,i){e(this).removeClass("ipt_uif_builder_tab_droppable_highlight")},over:function(t,i){e(this).addClass("ipt_uif_builder_tab_droppable_over")},out:function(t,i){e(this).removeClass("ipt_uif_builder_tab_droppable_over")},drop:function(t,a){var n=e(this),r=n.closest(".ipt_uif_builder_layout_tabs"),o=e("#"+r.attr("aria-controls")).find("> .ipt_uif_builder_drop_here"),s=i.tabs,l=s.find("> ul > li").index(r);s.tabs("option","active",l),i._addOrMoveElementToTabPanel(a.draggable,o,function(){n.removeClass("ipt_uif_builder_tab_droppable_highlight"),n.removeClass("ipt_uif_builder_tab_droppable_over")})}})},_getActiveTabPanelDropZone:function(){var t=this.tabs.tabs("option","active"),i=this.tabs.find(">ul>li.ipt_uif_builder_layout_tabs").eq(t).attr("aria-controls");return e("#"+i).find("> .ipt_uif_builder_drop_here")},applyMainTabDropZone:function(){var t=this;this.tabs.find("> .ui-tabs-panel").each(function(){t._makePanelDropNSortable(e(this))}),this.tabs.find("> .ui-tabs-nav li").each(function(){t._makeLiDroppable(e(this))})},_addNewPageToLayout:function(){var i=this.replaces.l_key,a=e("<div></div>").html(this.tabPanelContent).text(),n=this.keys.layout++,r=new RegExp(t(i),"g");a=a.replace(r,n);var o=this.tabs,s=o.attr("id"),l=s+"_"+n,d=s+"_li_"+n,p=e("<div></div>").html(this.tabLiContent).text();p=e(p);var _="Page "+(this.tabCounter+1);p.find(".tab_position").val(n),p.find("a").attr("href","#"+l),p.attr("id",d),p.find(".ipt_uif_builder_tab_droppable_title").html(_),o.find("> .ui-tabs-nav").append(p);var f=e('<div id="'+l+'">'+a+"</div>");f.attr("data-ipt-uif-builder-li",d),f.addClass("ipt_uif_builder_layout_tabs_wrap"),f.find(".ipt_uif_builder_tab_settings #layout_"+n+"_title").val(_),o.append(f),o.removeClass("ipt_uif_builder_empty"),this._refreshMainTabs(),this._makePanelDropNSortable(f),this._makeLiDroppable(p),o.tabs("option","active",o.find("> .ui-tabs-nav > li").length-1);var u=o.find(".ipt_uif_builder_layout_tab"),c=u.get(0),h=c.scrollWidth-c.clientWidth;h>0&&u.scrollLeft(h),this.jElement.trigger("pageAdded.eform")},applyAddLayout:function(){var e=this;this.adds.on("click",function(t){t.preventDefault(),e._addNewPageToLayout()})},_closeSettingsBox:function(){var t=this.currentSettingsOrigin,a=this.currentSettingsParent,n=this.jElement;if(null!==t&&null!==a){var r=this.settingsBox.find("textarea.wp_editor");if(r.length){var o,s,l=n.find(".ipt_uif_builder_wp_editor textarea").attr("id"),d=n.find(".ipt_uif_builder_wp_editor").find("textarea").eq(0);o="undefined"!=typeof tinyMCE?(s=tinyMCE.get(l))&&s instanceof tinymce.Editor&&!d.is(":visible")?switchEditors.pre_wpautop(s.getContent()):switchEditors.pre_wpautop(e("#"+l).val()):e("#"+l).val(),r.val(o),n.find(".ipt_uif_builder_wp_editor").css({position:"absolute",left:-9999})}a.hasClass("ipt_uif_droppable_element")&&a.find("> .ipt_uif_droppable_element_wrap").removeClass("white");var p,_,f=a.find("input.ipt_uif_builder_helper.element_m_type").val(),u=a.find("input.ipt_uif_builder_helper.element_key").val();if("layout"==f?e("#"+f+"_"+u+"_conditional_active").is(":checked")&&!e("#"+f+"_"+u+"_conditional_status").is(":checked")?(a.addClass("grayed"),e("#"+a.data("iptUifBuilderLi")).addClass("grayed")):(a.removeClass("grayed"),e("#"+a.data("iptUifBuilderLi")).removeClass("grayed")):e("#"+f+"_"+u+"_conditional_active").is(":checked")&&!e("#"+f+"_"+u+"_conditional_status").is(":checked")?a.find("> .ipt_uif_droppable_element_wrap").addClass("grayed"):a.find("> .ipt_uif_droppable_element_wrap").removeClass("grayed"),a.append(t),p=a.find(".element_m_type").val()+"_"+a.find(".element_key").val()+"_title",_=e("#"+p).val(),_=i(_),a.hasClass("ipt_uif_droppable_element_added"))_&&"string"==typeof _&&(a.find("> .ipt_uif_droppable_element_wrap > .ipt_uif_droppable_element_head > h3.element_title_h3 > span.element_title").text(" : "+_.trim()),a.find("> .ipt_uif_droppable_element_wrap > .ipt_uif_droppable_element_head > h3.element_title_h3").attr("title",_.trim()));else if(a.hasClass("ipt_uif_builder_layout_tabs_wrap")){var c=a.data("ipt-uif-builder-li"),h=e("#"+c);_&&"string"==typeof _&&h.find(".ipt_uif_builder_tab_droppable_title").text(_.trim())}this.currentSettingsOrigin=null,this.currentSettingsParent=null,this.settingsWrap.hide(),this.settingsTab.hide(),e("body").removeClass("eform-modal-active"),this.settingsBox.parent().stop(!0,!0).hide(),e(".ipt_uif_droppable_element.highlight").removeClass("highlight"),n.trigger("settingsClose.eform",a)}},_refreshSettingsNav:function(){var e=this.currentSettingsParent;e&&e.next(".ipt_uif_droppable_element, .ipt_uif_builder_layout_tabs_wrap").length?this.settingsNavNext.removeClass("disabled"):this.settingsNavNext.addClass("disabled"),e&&e.prev(".ipt_uif_droppable_element, .ipt_uif_builder_layout_tabs_wrap").length?this.settingsNavPrev.removeClass("disabled"):this.settingsNavPrev.addClass("disabled")},_openSettingsBox:function(t){if(null!==this.currentSettingsOrigin&&this._closeSettingsBox(),t.length){var i=this.jElement,a=t.parent(),n=a.find("> .ipt_uif_droppable_element_wrap > .ipt_uif_droppable_element_head > .element_title_h3"),r="Page";n.length&&(r=n.find("> .element_info").html()+" "+n.find("> .element_name").html()),r+=" Settings",this.currentSettingsOrigin=t,this.currentSettingsParent=a,this._refreshSettingsNav(),this.settingsBox.find(".ipt_uif_builder_settings_box_container").prepend(t),this.settingsBox.closest(".ipt_uif_builder_settings_box_parent").find("> .settings-heading > .settings-heading-text").html(r);var o=this.settingsBox.find("textarea.wp_editor").eq(0);if(o.length){this.settingsEditorLi.show();var s,l=i.find(".ipt_uif_builder_wp_editor"),d=l.find("textarea").eq(0);"undefined"!=typeof tinyMCE&&(s=tinyMCE.get(d.attr("id")));var p=o.val();l.css({position:"static",left:"auto"}),s&&s instanceof tinymce.Editor&&!d.is(":visible")?(s.setContent(switchEditors.wpautop(p)),s.save({no_events:!0})):"undefined"!=typeof switchEditors?d.val(switchEditors.pre_wpautop(p)):d.val(p)}else this.settingsEditorLi.hide();a.hasClass("ipt_uif_droppable_element")&&a.find("> .ipt_uif_droppable_element_wrap").addClass("white"),e("body").addClass("eform-modal-active"),this.settingsWrap.show(),this.settingsTab.show().tabs("option","active",0),this.settingsBox.parent().stop(!0,!0).css({height:"auto"}).hide().fadeIn("fast"),t.data("iptEformBuilderSettingsUI")||t.data("iptEformBuilderSettingsUI",t.iptPluginUIFAdmin({applyUIOnly:!0})),i.trigger("settingsOpen.eform",a)}},_setElementSettingsEvent:function(){var t=this;this.jElement.on("click",".element_title_h3, .ipt_uif_builder_settings_handle",function(i){var a=e(this);e(i.target);if(i.preventDefault(),!a.closest("#ipt-eform-builder-droppables-container").length){var n=a.closest(".ipt_uif_droppable_element").find("> .ipt_uif_builder_settings");t._openSettingsBox(n)}})},_setNestedElementEvents:function(){this.jElement.on("click",".ipt_uif_builder_droppable_handle",function(t){t.preventDefault();var i=e(this),a=i.closest(".ipt_uif_droppable_element_wrap").find("> .ipt_uif_builder_drop_here");i.hasClass("ipt_uif_builder_droppable_handle_open")?(i.removeClass("ipt_uif_builder_droppable_handle_open"),a.stop(!0,!0).slideUp("normal")):(i.addClass("ipt_uif_builder_droppable_handle_open"),a.stop(!0,!0).slideDown("normal"))})},_setElementDeleteAction:function(){var t=this;this.jElement.on("click",".ipt_uif_builder_remove_handle",function(i){i.preventDefault();var a=e(this).closest(".ipt_uif_droppable_element");t.deleteDialogueContent.dialog({autoOpen:!0,buttons:{Confirm:function(){t._deleteElement(a),e(this).dialog("close")},Cancel:function(){e(this).dialog("close")}},modal:!0,minWidth:600,closeOnEscape:!0,title:t.deleteMsgTitle,create:function(t,i){e("body").addClass("ipt_uif_common")},close:function(t,i){e("body").removeClass("ipt_uif_common")}})})},_setElementCopyAction:function(){var t=this;this.jElement.on("click",".ipt_uif_builder_copy_handle",function(i){i.preventDefault();var a=e(this).closest(".ipt_uif_droppable_element");t._duplicateElement(a)})},applyElementActions:function(){this._setElementSettingsEvent(),this._setNestedElementEvents(),this._setElementDeleteAction(),this._setElementCopyAction()},_navigateSettingsBox:function(e){void 0===e&&(e="next");var t=this.currentSettingsParent;if(t){var i="prev"===e?t.prev(".ipt_uif_droppable_element, .ipt_uif_builder_layout_tabs_wrap"):t.next(".ipt_uif_droppable_element, .ipt_uif_builder_layout_tabs_wrap");i.length&&this._openSettingsBox(i.find("> .ipt_uif_builder_settings"))}},_setSettingsBoxActions:function(){var e=this;this.jElement.on("click",".ipt_uif_builder_settings_save, .builder_settings_save, .ipt_uif_builder_settings_save_wp_editor",function(t){t.preventDefault(),e._closeSettingsBox()}),this.jElement.on("click",".builder_settings_prev",function(t){t.preventDefault(),e._navigateSettingsBox("prev")}),this.jElement.on("click",".builder_settings_next",function(t){t.preventDefault(),e._navigateSettingsBox("next")}),this.settingsTab.draggable({containment:"#ipt-eform-builder-settings-wrap",handle:".builder_settings_drag"}),this.jElement.on("click",".builder_settings_drag",function(e){e.preventDefault()}),this.jElement.on("dblclick",".builder_settings_drag",function(t){t.preventDefault(),e.settingsTab.css({left:"",top:"",right:"",bottom:"",height:"",width:""})})},applySettingsBoxEvents:function(){this.settingsWrap.iptPluginUIFAdmin(),this.settingsTab.hide(),this._setSettingsBoxActions()},_setCustomizerTrigger:function(){var t=e("body"),i=this;this.jElement.on("click",".ipt-eform-customizer-trigger",function(a){var n=e(this).data("target"),r=e("#"+n);a.preventDefault(),t.addClass("eform-modal-active"),r.show(),i.jElement.trigger("customizerOpen.eform")})},_setCustomizerSave:function(){var t=e("body"),i=this;t.on("click",".wpq-eform-main-settings-wrap .ipt-eform-customizer-save .ipt_uif_button, .wpq-eform-main-settings-wrap .wpq-eform-main-settings-close",function(a){a.preventDefault(),e(this).closest(".wpq-eform-main-settings-wrap").hide(),i.jElement.trigger("customizerClose.eform"),t.removeClass("eform-modal-active")})},applyCustomizer:function(){this._setCustomizerTrigger(),this._setCustomizerSave()},_streamIframeSyncEvent:function(e,t){var i=this.iframeElm;try{i[0].contentWindow.jQuery("body").trigger(e+".eform",t)}catch(a){i.one("load",function(){i[0].contentWindow.jQuery("body").trigger(e+".eform",t)})}},_fireIframeSyncEvents:function(e){var t={html:"",currentTab:this.tabs.tabs("option","active")};e&&e.html&&(t.html=e.html),this._streamIframeSyncEvent("syncIframe",t),this.iframeOverlayIndicator.stop(!0,!0).fadeOut()},_fireIframeElementEvent:function(e,t){if(e.hasClass("ipt_uif_droppable_element")){t=!!t;var i=e.find(".ipt_uif_builder_helper.element_m_type").val(),a=e.find(".ipt_uif_builder_helper.element_key").val(),n={currentTab:this.tabs.tabs("option","active"),mType:i,key:a,now:t};this._streamIframeSyncEvent("syncElement",n)}},_stopIframeLoadingAnimation:function(){this.toolbarWorkingIndicator.removeClass("active"),this.iframeRefreshButton.removeClass("active"),this._stopIframeOverlay()},_startIframeLoadingAnimation:function(){this.toolbarWorkingIndicator.addClass("active"),this.iframeRefreshButton.addClass("active"),this._startIframeOverlay()},_startIframeOverlay:function(){this.iframeOverlayIndicator.stop(!0,!0).fadeIn()},_stopIframeOverlay:function(){this.iframeOverlayIndicator.stop(!0,!0).fadeOut()},_refreshLiveIframe:function(){this._startIframeLoadingAnimation(),this.iframeElm.get(0).contentWindow.location.reload(!0)},applyLivePreview:function(){var t=this,i=this.iframeElm.get(0),a=i.contentDocument||i.contentWindow.document;this.iframeElm.on("load",function(){t._stopIframeLoadingAnimation(),t._fireIframeSyncEvents()}),"complete"===a.readyState&&this.iframeOverlayIndicator.stop(!0,!0).fadeOut(),e("#ipt-eform-builder-toolbar-iframe-size").on("click","a",function(i){i.preventDefault();var a,n=e(this);n.parent().find("a").removeClass("active"),n.addClass("active");var r=["fit","desktop","tablet","mobile"];for(a=0;a<r.length;a++)t.iframeContainer.removeClass(r[a]);t.iframeContainer.addClass(n.data("stretch"))}),e("#ipt-eform-builder-toolbar-actions .refresher").on("click",function(e){e.preventDefault(),t._refreshLiveIframe()})},_setPaneViewSelector:function(){var t=[],i=this;this.paneSelector.find("a").each(function(){t.push(e(this).data("class"))}),this.paneSelector.on("click","a",function(a){a.preventDefault(),t.forEach(function(e){i.pane.removeClass(e)});var n=e(this);i.pane.addClass(n.data("class")),i.paneSelector.find("a").removeClass("active"),n.addClass("active")})},_resetPaneSize:function(){this.paneLeft.css({width:""}),this.paneRight.css({width:""}),this.paneResize.css({left:"calc(50% - 4px)"})},_setPaneSizeHandler:function(){var e=this;this.paneResize.draggable({axis:"x",containment:"parent",drag:function(t,i){var a=e.pane.width(),n=i.position.left/a*100,r=100-n;e.paneLeft.css({width:n+"%"}),e.paneRight.css({width:"calc("+r+"% - 8px)"})},start:function(){e.iframeContainer.addClass("overlayed")},stop:function(){e.iframeContainer.removeClass("overlayed")}})},applySplitPane:function(){var t=this;this._setPaneViewSelector(),this._setPaneSizeHandler(),this.paneResize.on("dblclick",function(){t._resetPaneSize()}),e(window).on("resize",e.debounce(250,function(){t._resetPaneSize()}))},_setSaveAndSyncEvents:function(){var t=this;["customizerClose","elementAdded","elementMoved","elementDeleted","elementCopied","pageDeleted","pageCopied","pageSorted","settingsClose"].forEach(function(i){t.jElement.on(i+".eform",e.debounce(500,function(){t._saveAndSyncIframe(i)}))}),e("#name").on("change",e.debounce(500,function(){t._saveAndSyncIframe("nameChanged")})),this.jElement.on("pageAdded.eform",function(){iziToast.show({message:eFormBuilderL10n.pageAdded,theme:"light",color:"green",icon:"ipt-icomoon-done",layout:1,closeOnClick:!0,transitionIn:"fadeIn",displayMode:0,position:"topRight",timeout:1500,pauseOnHover:!0})}),this.saveButton.on("click",function(e){e.preventDefault(),t._saveAndSyncIframe("formSaved")})},_setElementSyncEvents:function(){var t=this;this.jElement.on(["settingsOpen.eform"].join(" "),e.debounce(500,function(i,a){t._fireIframeElementEvent(e(a))})),this.jElement.on("mouseenter",".ipt_uif_droppable_element_added",function(i){t.isFormSaving||t._fireIframeElementEvent(e(this),!0)})},_setTwoWaySync:function(){var t=this,i=!1,a=this.tabs;function n(e){var t=a.tabs("option","active");e&&e.currentTab!==t&&(i=!0,a.tabs("option","active",e.currentTab),i=!1)}a.on("tabsactivate",function(){i||t._fireIframeSyncEvents()}),e(document).on("tabSyncForward.eform",function(e,t){n(t)}),e(document).on("configForward.eform",function(i,a){var r=a.parts;a.currentTab;if(r&&r[2]&&r[3]){var o=r[2],s=r[3],l=e("#eform-form-element-settings-"+o+"-"+s);l.length&&(n(a),t._openSettingsBox(l.closest(".ipt_uif_droppable_element").find("> .ipt_uif_builder_settings")))}}),e(document).on("elementSyncForward.eform",function(t,i){var a=i.parts;if(a&&a[2]&&a[3]){var r=a[2],o=a[3],s=e("#eform-form-element-settings-"+r+"-"+o);if(s.length){n(i);var l=s.closest(".ipt_uif_droppable_element");e(".ipt_uif_droppable_element.highlight").removeClass("highlight"),l.addClass("highlight");var d=l.closest(".ipt_uif_builder_layout_tabs_wrap"),p=d.scrollTop()+l.offset().top-d.offset().top-50;d.stop(!0,!0).animate({scrollTop:p},100)}}})},applySaveAndSync:function(){this._setSaveAndSyncEvents(),this._setElementSyncEvents(),this._setTwoWaySync()},_openLayoutSettings:function(t){var i=t.attr("aria-controls"),a=e("#"+i).find(".ipt_uif_builder_tab_settings");this._openSettingsBox(a)},_duplicateLayout:function(t){var i=t.attr("aria-controls");this._closeSettingsBox(),this._addNewPageToLayout();var a=this.tabs.tabs("option","active"),n=this.tabs.find(".ui-tabs-nav li").eq(a).attr("aria-controls"),r=e("#"+i),o=e("#"+n),s=r.find(">.ipt_uif_builder_drop_here").clone(),l=o.find(">.ipt_uif_builder_drop_here"),d=l.data("containerKey");l.remove(),s.find('[data-dbmap="1"]').remove(),s.appendTo(o),this._updateDuplicatedDOMInnerKeys(s,d),this._refreshMainTabs(),this._makePanelDropNSortable(o),this.jElement.trigger("pageCopied.eform")},_deleteLayout:function(t){var i=e("#"+t.attr("aria-controls")),a=this;this.deleteDialogueContent.dialog({autoOpen:!0,buttons:{Confirm:function(){t.remove(),i.find('[data-dbmap="1"]').each(function(){var t=e(this).data("ipt_uif_builder_dbmap_original");t&&t.removeClass("ipt_uif_droppable_element_disabled")}),i.remove(),a._refreshMainTabs(),e(this).dialog("close"),a.jElement.trigger("pageDeleted.eform")},Cancel:function(){e(this).dialog("close")}},modal:!0,minWidth:600,closeOnEscape:!0,title:this.deleteMsgTitle,create:function(t,i){e("body").addClass("ipt_uif_common")},close:function(t,i){e("body").removeClass("ipt_uif_common")}})},_handleLayoutAction:function(e,t){var i=e.closest(".ipt_uif_builder_layout_tabs");switch(t){case"settings":this._openLayoutSettings(i);break;case"copy":this._duplicateLayout(i);break;case"delete":this._deleteLayout(i);break;default:console.log("Layout action not supported")}},applyLayoutActions:function(){var t=this;this.jElement.on("click",".ipt-eform-layout-tab-actions__settings",function(i){t._handleLayoutAction(e(this),"settings")}),this.jElement.on("click",".ipt-eform-layout-tab-actions__copy",function(i){t._handleLayoutAction(e(this),"copy")}),this.jElement.on("click",".ipt-eform-layout-tab-actions__delete",function(i){t._handleLayoutAction(e(this),"delete")})},_setAddersDraggable:function(){this.elementAdders.find(".ipt_uif_droppable_element").draggable({revert:"invalid",revertDuration:200,helper:"clone",zIndex:9999,appendTo:this.jElement,cancel:".ipt_uif_droppable_element_disabled",handle:".ipt_uif_builder_sort_handle",cursorAt:{left:28,top:25},delay:100})},_setAddersClickable:function(){var t=this;this.jElement.on("click","#ipt-eform-builder-droppables-container .ipt_uif_droppable_element",function(i){i.preventDefault();var a=e(this);a.hasClass("ipt_uif_droppable_element_disabled")||(t.tabCounter<1&&t._addNewPageToLayout(),t._addElementToTabPanel(a,t._getActiveTabPanelDropZone()))})},_resetAdderSearchable:function(){this.adderSearchInput.val(""),this.adderSearchPrefix.removeClass("is-cancellable"),this.adderSearchAllCategories.show(),this.adderSearchAllAdders.show()},_showSearchedAdders:function(e){var t=this,i=e.match(/^type:(\s?)([a-zA-Z]+)(\s?)$/i);Object.keys(this.adderSearch).forEach(function(n){var r=!1;t.adderSearch[n].items.forEach(function(t){var n=!1;null===i?n=a(e,t.title):t.tags&&t.tags.length&&t.tags.forEach(function(e){n=n||a(i[2].toLowerCase(),e)}),n?(t.elm.show(),r=!0):t.elm.hide()}),r?t.adderSearch[n].wrap.show():t.adderSearch[n].wrap.hide()})},_setAddersSearchable:function(){var t={mcq:{wrap:null,items:[]},freetype:{wrap:null,items:[]},pinfo:{wrap:null,items:[]},design:{wrap:null,items:[]}},i=this;Object.keys(t).forEach(function(a){var n=i.elementAdders.find(".ipt-eform-droppable-wrapper__category--"+a);t[a].wrap=n,n.find(".ipt_uif_droppable_element").each(function(){var i=e(this);t[a].items.push({title:i.find(".element_name").text().toLowerCase(),elm:i,tags:i.data("tags")||[]})})}),this.adderSearch=t,this.adderSearchPrefix=e("#ipt-eform-droppables-search .ipt-eform-droppables-search__prefix"),this.adderSearchInput=e("#ipt-eform-droppables-search__input"),this.adderSearchCancel=e("#ipt-eform-droppables-search__cancel"),this.adderSearchHelp=e("#ipt-eform-droppables-search__help"),this.adderSearchAllCategories=this.elementAdders.find(".ipt-eform-droppable-wrapper__category"),this.adderSearchAllAdders=this.elementAdders.find(".ipt_uif_droppable_element");var a=["quiz","numeric","text"],n=a.slice(0);this.adderSearchInput.on("input",function(t){var r=e(this).val();n=a.slice(0),""===r?i._resetAdderSearchable():(i.adderSearchPrefix.addClass("is-cancellable"),i._showSearchedAdders(r))}),this.adderSearchCancel.on("click",function(e){e.preventDefault(),n=a.slice(0),i._resetAdderSearchable()}),this.adderSearchHelp.on("click",function(e){e.preventDefault();var t="";n.length?(t="type:"+n.shift(),i.adderSearchInput.val(t),i.adderSearchPrefix.addClass("is-cancellable"),i._showSearchedAdders(t)):(n=a.slice(0),i._resetAdderSearchable())})},applyElementAdder:function(){this._setAddersDraggable(),this._setAddersClickable(),this._setAddersSearchable()},_openContextDialog:function(t,i){var a=e("#"+t),n={};n[iptPluginUIFAdmin.L10n.got_it]=function(){e(this).dialog("close")},a.dialog({buttons:n,modal:!0,minWidth:1024,closeOnEscape:!0,title:i,create:function(t,i){e("body").addClass("ipt_uif_common")},close:function(t,i){e("body").removeClass("ipt_uif_common"),e(this).find("iframe").each(function(){var t=e(this);t.attr("src",t.attr("src"))})}})},applyContextHelp:function(){var t=this;this.jElement.on("click",".ipt-eform-builder-context-help",function(i){i.preventDefault();var a=e(this),n=a.find("span").text();n||(n=a.attr("title")),t._openContextDialog(a.data("target"),n)})},applyOnboarding:function(){var t=!1,i=this,a=eFormBuilderL10n.onBoarding,n=a.steps,r=function(){t||!1===t&&(t=new Driver({animate:!0,opacity:.85,padding:10,allowClose:!1,overlayClickNext:!0,doneBtnText:a.done,closeBtnText:a.close,stageBackground:"#ffffff",nextBtnText:a.next,prevBtnText:a.prev,showButtons:!0,keyboardControl:!0})).defineSteps([{element:"#eform-split-view-left",popover:{title:n[1].title,description:n[1].description,position:"right"}},{element:"#eform-split-view-right",popover:{title:n[2].title,description:n[2].description,position:"left"}},{element:"#ipt-eform-builder-toolbar",popover:{title:n[3].title,description:n[3].description,position:"bottom-center"}},{element:"#ipt-eform-builder-toolbar-addcontainer",popover:{title:n[4].title,description:n[4].description,position:"right"}},{element:"#ipt-eform-builder-droppables-container",popover:{title:n[5].title,description:n[5].description,position:"right"}},{element:"#ipt-eform-builder-toolbar-settings",popover:{title:n[6].title,description:n[6].description,position:"right"}},{element:"#ipt-eform-builder-toolbar-theme",popover:{title:n[7].title,description:n[7].description,position:"right"}},{element:"#ipt-eform-builder-form-help",popover:{title:n[8].title,description:n[8].description,position:"right"}}]),i._getActiveTabPanelDropZone().hasClass("ipt_uif_builder_drop_here_empty")&&i._addShortcutElementToActiveTabPanel("radio"),t.start()};if(!eFormBuilderL10n.onBoarding.isOnBoarded&&Math.max(document.documentElement.clientWidth,window.innerWidth||0)>1200){var o=e("<div />");o.html('<p style="font-size: 16px;">'+n[0].description+"</p>"),o.dialog({autoOpen:!0,title:n[0].title,buttons:[{text:a.openVideo,click:function(){e(this).dialog("close"),i._openContextDialog("eform-builder-help-quickstart",a.openVideo)}},{text:a.startTour,click:function(t){t.stopPropagation(),t.preventDefault(),e(this).dialog("close"),r()}}],modal:!0,minWidth:600,closeOnEscape:!0,create:function(t,i){e("body").addClass("ipt_uif_common")},close:function(t,i){e("body").removeClass("ipt_uif_common")},position:{my:"center top+100px",at:"center top",of:window}})}e("#eform-onboarding-trigger").on("click",function(e){e.preventDefault(),e.stopPropagation(),r()})}},e(document).ready(function(){e(".ipt_uif_builder").length&&(window.eFormBuilder=new n(e(".ipt_uif_builder")))})}(jQuery);